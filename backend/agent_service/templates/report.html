<!-- app/templates/report.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Renovation ROI Report</title>
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #2196F3;
            --accent-color: #FFC107;
            --text-color: #333;
            --light-gray: #f5f5f5;
            --border-color: #e0e0e0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            border-radius: 10px 10px 0 0;
            margin-bottom: 30px;
        }
        
        h1, h2, h3, h4 {
            margin-top: 0;
        }
        
        .report-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .property-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .property-header {
            display: flex;
            justify-content: space-between;
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .property-details {
            flex: 1;
        }
        
        .property-address {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .property-price {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .property-stats {
            display: flex;
            gap: 20px;
            font-size: 16px;
            color: #666;
        }
        
        .property-stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .image-gallery {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .gallery-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .gallery-image:hover {
            transform: scale(1.02);
        }
        
        .summary-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .summary-title {
            font-size: 22px;
            font-weight: 600;
        }
        
        .summary-score {
            background-color: var(--primary-color);
            color: white;
            font-size: 18px;
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 30px;
        }
        
        .metrics-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .metric-card {
            background-color: var(--light-gray);
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .metric-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .metric-range {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        
        .renovation-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .renovation-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            padding: 0;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }
        
        .renovation-header {
            padding: 15px 20px;
            background-color: var(--light-gray);
            border-bottom: 1px solid var(--border-color);
        }
        
        .renovation-name {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
            display: flex;
            justify-content: space-between;
        }
        
        .renovation-roi {
            background-color: var(--accent-color);
            padding: 2px 8px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
        }
        
        .renovation-content {
            padding: 20px;
        }
        
        .renovation-description {
            margin-bottom: 15px;
            font-size: 15px;
            color: #555;
        }
        
        .renovation-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .renovation-metric {
            background-color: var(--light-gray);
            padding: 10px;
            border-radius: 5px;
        }
        
        .renovation-metric-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 3px;
        }
        
        .renovation-metric-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-color);
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin: 35px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .disclaimer {
            font-size: 12px;
            color: #777;
            margin-top: 40px;
            padding: 15px;
            background-color: var(--light-gray);
            border-radius: 5px;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
        }
        
        .modal-content {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
        }
        
        .modal-image {
            max-width: 90%;
            max-height: 90%;
            border: 3px solid white;
        }
        
        .close {
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 35px;
            color: #f1f1f1;
            cursor: pointer;
        }

        .description-bullets, .metric-bullets {
            padding-left: 20px;
            margin-top: 5px;
            margin-bottom: 5px;
        }

        .description-bullets li, .metric-bullets li {
            margin-bottom: 4px;
        }

        .renovation-metric.full-width {
            grid-column: 1 / -1; /* Span all columns */
        }

        .renovation-metric-range {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
        }

        .renovation-header {
            padding: 15px 20px;
            background-color: var(--light-gray);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
        }

        .renovation-name {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            flex-wrap: nowrap;
        }

        .renovation-roi {
            background-color: var(--accent-color);
            padding: 2px 8px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            white-space: nowrap;
            min-width: 50px;
            text-align: center;
            margin-left: 10px;
            flex-shrink: 0;
        }

        /* Carousel Styling */
        .carousel-container {
            margin-bottom: 30px;
            overflow: hidden;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .carousel {
            position: relative;
            width: 100%;
        }

        .carousel-inner {
            display: flex;
            transition: transform 0.5s ease-in-out;
            height: 400px;
        }

        .carousel-item {
            min-width: 100%;
            flex: 0 0 auto;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f1f1f1;
        }

        .carousel-image {
            max-width: 100%;
            max-height: 400px;
            object-fit: contain;
        }

        .carousel-control {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.5);
            border: none;
            border-radius: 50%;
            font-size: 18px;
            color: #333;
            cursor: pointer;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }

        .carousel-control:hover {
            background-color: rgba(255, 255, 255, 0.8);
        }

        .carousel-control.prev {
            left: 10px;
        }

        .carousel-control.next {
            right: 10px;
        }

        .carousel-indicators {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
        }

        .indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.5);
            border: none;
            cursor: pointer;
            padding: 0;
        }

        .indicator.active {
            background-color: white;
            width: 12px;
            height: 12px;
        }
                
        @media (max-width: 768px) {
            .property-header {
                flex-direction: column;
            }
            .property-stats {
                flex-wrap: wrap;
            }
            .metrics-container, .renovation-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="report-meta">
                <span>Report ID: {{ report_id }}</span>
                <span>Generated: {{ report.created_at.strftime('%B %d, %Y') }}</span>
            </div>
            <h1>Renovation ROI Analysis</h1>
        </header>
        
        <!-- Property Details -->
        <div class="property-card">
            <div class="property-header">
                <div class="property-details">
                    <div class="property-address">{{ report.property.address }}</div>
                    <div class="property-price">{{ report.property.price }}</div>
                    <div class="property-stats">
                        {% if report.property.beds %}
                        <div class="property-stat">
                            <span>üõèÔ∏è</span>
                            <span>{{ report.property.beds }} beds</span>
                        </div>
                        {% endif %}
                        
                        {% if report.property.baths %}
                        <div class="property-stat">
                            <span>üöø</span>
                            <span>{{ report.property.baths }} baths</span>
                        </div>
                        {% endif %}
                        
                        {% if report.property.sqft %}
                        <div class="property-stat">
                            <span>üìè</span>
                            <span>{{ report.property.sqft }}</span>
                        </div>
                        {% endif %}
                        
                        {% if report.property.yearBuilt %}
                        <div class="property-stat">
                            <span>üèóÔ∏è</span>
                            <span>Built in {{ report.property.yearBuilt }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Image Gallery -->
            {% if report.property.images and report.property.images|length > 0 %}
            <div class="carousel-container">
              <div class="carousel">
                <div class="carousel-inner">
                  {% for image in report.property.images %}
                  <div class="carousel-item {% if loop.first %}active{% endif %}" data-index="{{ loop.index0 }}">
                    <img src="{{ image }}" alt="Property Image {{ loop.index }}" class="carousel-image">
                  </div>
                  {% endfor %}
                </div>
                
                <button class="carousel-control prev" aria-label="Previous image">&#10094;</button>
                <button class="carousel-control next" aria-label="Next image">&#10095;</button>
                
                <div class="carousel-indicators">
                  {% for image in report.property.images %}
                  <button class="indicator {% if loop.first %}active{% endif %}" data-index="{{ loop.index0 }}" aria-label="Go to image {{ loop.index }}"></button>
                  {% endfor %}
                </div>
              </div>
            </div>
            {% endif %}
        </div>
        
        <!-- Summary Stats -->
        <div class="summary-card">
            <div class="summary-header">
                <div class="summary-title">Renovation Potential</div>
                {% if report.quick_insights %}
                <div class="summary-score">{{ report.quick_insights.potentialScore }}/10</div>
                {% endif %}
            </div>
            
            {% if report.quick_insights %}
            <div class="metrics-container">
                <div class="metric-card">
                    <div class="metric-label">Estimated Renovation Budget</div>
                    <div class="metric-value">${{ "{:,}".format(report.quick_insights.estimatedBudget) }}</div>
                    {% if report.detailed_report %}
                    <div class="metric-range">
                        Range: ${{ "{:,}".format(report.detailed_report.total_budget.low) }} - ${{ "{:,}".format(report.detailed_report.total_budget.high) }}
                    </div>
                    {% endif %}
                </div>
                
                <div class="metric-card">
                    <div class="metric-label">Potential Value Increase</div>
                    <div class="metric-value">${{ "{:,}".format(report.quick_insights.potentialValueAdd) }}</div>
                    {% if report.detailed_report %}
                    <div class="metric-range">
                        Range: ${{ "{:,}".format(report.detailed_report.potential_value_increase.low) }} - ${{ "{:,}".format(report.detailed_report.potential_value_increase.high) }}
                    </div>
                    {% endif %}
                </div>
                
                {% if report.detailed_report %}
                <div class="metric-card">
                    <div class="metric-label">Average ROI</div>
                    <div class="metric-value">{{ report.detailed_report.average_roi }}%</div>
                </div>
                {% endif %}
            </div>
            {% endif %}
        </div>
        
        <!-- Top Renovation Opportunities -->
        <h2 class="section-title">Top Renovation Opportunities</h2>
        
        <div class="renovation-cards">
            {% if report.detailed_report and report.detailed_report.renovation_ideas %}
              {% for idea in report.detailed_report.renovation_ideas %}
                <div class="renovation-card">
                  <div class="renovation-header">
                    <div class="renovation-name">
                      {{ idea.name }}
                      <span class="renovation-roi">      
                        {% if idea.roi is defined %}
                        {{ "%.0f"|format(idea.roi) }}%
                      {% elif idea.adjusted_roi is defined %}
                        {{ "%.0f"|format(idea.adjusted_roi) }}%
                      {% else %}
                        --
                      {% endif %}</span>
                    </div>
                  </div>
                  <div class="renovation-content">
                    {% if idea.description %}
                      <div class="renovation-description">
                        <!-- Convert the description to bullet points -->
                        {% set description_points = idea.description.split('. ') %}
                        <ul class="description-bullets">
                          {% for point in description_points %}
                            {% if point|trim %}
                              <li>{{ point|trim }}{% if not point.endswith('.') %}.{% endif %}</li>
                            {% endif %}
                          {% endfor %}
                        </ul>
                      </div>
                    {% endif %}
                    
                    <div class="renovation-metrics">
                      {% if idea.estimated_cost %}
                        <div class="renovation-metric">
                          <div class="renovation-metric-label">Estimated Cost</div>
                          <div class="renovation-metric-value">${{ "{:,}".format(idea.estimated_cost.medium) }}</div>
                          <div class="renovation-metric-range">
                            <ul class="metric-bullets">
                              <li>Low: ${{ "{:,}".format(idea.estimated_cost.low) }}</li>
                              <li>High: ${{ "{:,}".format(idea.estimated_cost.high) }}</li>
                            </ul>
                          </div>
                        </div>
                      {% endif %}
                      
                      {% if idea.estimated_value_add %}
                        <div class="renovation-metric">
                          <div class="renovation-metric-label">Value Added</div>
                          <div class="renovation-metric-value">${{ "{:,}".format(idea.estimated_value_add.medium) }}</div>
                          <div class="renovation-metric-range">
                            <ul class="metric-bullets">
                              <li>Low: ${{ "{:,}".format(idea.estimated_value_add.low) }}</li>
                              <li>High: ${{ "{:,}".format(idea.estimated_value_add.high) }}</li>
                            </ul>
                          </div>
                        </div>
                      {% endif %}
                      
                      {% if idea.feasibility %}
                        <div class="renovation-metric">
                          <div class="renovation-metric-label">Difficulty</div>
                          <div class="renovation-metric-value">{{ idea.feasibility }}</div>
                        </div>
                      {% endif %}
                      
                      {% if idea.timeline %}
                        <div class="renovation-metric">
                          <div class="renovation-metric-label">Timeline</div>
                          <div class="renovation-metric-value">{{ idea.timeline }}</div>
                        </div>
                      {% endif %}
                      
                      {% if idea.local_trends or idea.market_demand %}
                        <div class="renovation-metric full-width">
                          <div class="renovation-metric-label">Market Insights</div>
                          <div class="renovation-metric-value">
                            <ul class="metric-bullets">
                              {% if idea.market_demand %}
                                <li>Demand: {{ idea.market_demand }}</li>
                              {% endif %}
                              {% if idea.local_trends %}
                                <li>{{ idea.local_trends }}</li>
                              {% endif %}
                            </ul>
                          </div>
                        </div>
                      {% endif %}
                    </div>
                  </div>
                </div>
              {% endfor %}
            {% elif report.quick_insights and report.quick_insights.topOpportunities %}
              <!-- Quick insights fallback here -->
            {% endif %}
          </div>
        
        <!-- Market Analysis -->
        {% if report.detailed_report and report.detailed_report.market_summary %}
        <h2 class="section-title">Market Analysis</h2>
        <div class="summary-card">
            <p>{{ report.detailed_report.market_summary }}</p>
        </div>
        {% endif %}
        
        <!-- Additional Suggestions -->
        {% if report.detailed_report and report.detailed_report.additional_suggestions %}
        <h2 class="section-title">Additional Suggestions</h2>
        <div class="renovation-cards">
            {% for suggestion in report.detailed_report.additional_suggestions %}
            <div class="renovation-card">
                <div class="renovation-header">
                    <div class="renovation-name">
                        {{ suggestion.name }}
                    </div>
                </div>
                <div class="renovation-content">
                    <div class="renovation-description">{{ suggestion.description }}</div>
                    {% if suggestion.reason %}
                    <div class="renovation-description">
                        <strong>Why:</strong> {{ suggestion.reason }}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <div class="disclaimer">
            <p><strong>Disclaimer:</strong> This renovation ROI analysis is provided for informational purposes only and should not be considered financial advice. Actual costs and returns may vary based on market conditions, contractor availability, material costs, and other factors. We recommend consulting with local contractors and real estate professionals before making investment decisions.</p>
        </div>
    </div>
    
    <!-- Image Modal -->
    <div id="imageModal" class="modal">
        <span class="close" onclick="closeModal()">&times;</span>
        <div class="modal-content">
            <img id="modalImage" class="modal-image">
        </div>
    </div>
    
    <script>
        // Image Modal Functions
        function openModal(imageSrc) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            modal.style.display = "block";
            modalImg.src = imageSrc;
        }
        
        function closeModal() {
            document.getElementById('imageModal').style.display = "none";
        }
        
        // Close modal when clicking outside the image
        window.onclick = function(event) {
            const modal = document.getElementById('imageModal');
            if (event.target == modal) {
                closeModal();
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
        // Initialize carousel
        const carousel = document.querySelector('.carousel');
        if (!carousel) return;
        
        const inner = carousel.querySelector('.carousel-inner');
        const items = carousel.querySelectorAll('.carousel-item');
        const indicators = carousel.querySelectorAll('.indicator');
        const prevBtn = carousel.querySelector('.prev');
        const nextBtn = carousel.querySelector('.next');
        const itemCount = items.length;
        let currentIndex = 0;
        
        // Function to update carousel display
        function updateCarousel() {
        inner.style.transform = `translateX(-${currentIndex * 100}%)`;
        
        // Update active states
        items.forEach((item, index) => {
            item.classList.toggle('active', index === currentIndex);
        });
        
        indicators.forEach((indicator, index) => {
            indicator.classList.toggle('active', index === currentIndex);
        });
        }
        
        // Event listeners for controls
        if (prevBtn) {
        prevBtn.addEventListener('click', () => {
            currentIndex = (currentIndex - 1 + itemCount) % itemCount;
            updateCarousel();
        });
        }
        
        if (nextBtn) {
        nextBtn.addEventListener('click', () => {
            currentIndex = (currentIndex + 1) % itemCount;
            updateCarousel();
        });
        }
        
        // Event listeners for indicators
        indicators.forEach(indicator => {
        indicator.addEventListener('click', () => {
            currentIndex = parseInt(indicator.dataset.index);
            updateCarousel();
        });
        });
        
        // Keyboard navigation
        document.addEventListener('keydown', event => {
        if (event.key === 'ArrowLeft') {
            currentIndex = (currentIndex - 1 + itemCount) % itemCount;
            updateCarousel();
        } else if (event.key === 'ArrowRight') {
            currentIndex = (currentIndex + 1) % itemCount;
            updateCarousel();
        }
        });
        
        let interval = setInterval(() => {
        currentIndex = (currentIndex + 1) % itemCount;
        updateCarousel();
        }, 5000); // Change slide every 5 seconds
        
        carousel.addEventListener('mouseenter', () => {
        clearInterval(interval);
        });
        
        carousel.addEventListener('mouseleave', () => {
        interval = setInterval(() => {
            currentIndex = (currentIndex + 1) % itemCount;
            updateCarousel();
        }, 5000);
        });

        
        // Initialize the carousel
        updateCarousel();
    });
    </script>
</body>
</html>